## STATIC CONFIGURATION
log:
  level: INFO

api:
  insecure: true
  dashboard: true
  debug: true

entryPoints:
  web:
    address: ":80"

providers:
  docker:
    endpoint: "unix:///var/run/docker.sock"
    exposedByDefault: false
  file:
    filename: "traefik.yml"

## DYNAMIC CONFIGURATION
http:
  routers:
    route-to-server:
      rule: "Path(`/api`)"
      service: route-to-api-service
      middlewares:
        - "test-auth"
      priority: 1000
      entryPoints:
        - web
    route-to-auth:
      rule: "Path(`/login`)"
      service: "route-to-authorize-api"
      middlewares:
        - "test-replacepath-authorize"
      priority: 0
      entryPoints:
        - web
  middlewares:
    test-auth:
      forwardAuth:
        address: "http://sso_service:4445/validate"
#        address: "http://127.0.0.1:4445/validate"
    test-replacepath-authorize:
      replacePath:
        path: "/api/authorize"
  services:
    route-to-authorize-api:
      networks:
        - backend
      loadBalancer:
        servers:
#          - url: "https://google.com"
#          - url: "http://host.docker.internal:4445/api/authorize"
          - url: "http://sso_service:4445"
    route-to-api-service:
      networks:
        - backend
      loadBalancer:
        servers:
#          - url: "http://host.docker.internal:4445/health"
          - url: "http://127.0.0.1:4445/health"